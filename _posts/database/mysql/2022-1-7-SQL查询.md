---
layout: post
date: 2022-01-07 12:14:16 +0800
author: solitaryclown
title: SQL查询
categories: mysql
tags: database mysql
# permalink: /:categories/:title.html
excerpt: "SQL查询"
---
* content
{:toc}

# SQL查询
## 基本格式

```sql
select 
    [all|distinct]
    <目标列或表达式> [别名], 
    <目标列或表达式> [别名], 
    ...
from 
    <表名或视图名> [别名],
    <表名或视图名> [别名],
	...
[where <条件表达式>]
[group by <列名>]
[having <条件表达式>]
[order by <列名>] [asc|desc]
[limit offset,rows]
```

## 简单查询
```sql
-- 查询所有列
select * FROM product;

-- 查询指定列
SELECT  pname,price FROM product;

-- 表别名
select * from product as p;

-- 列别名
SELECT  pname as 'product_name',price 'price' FROM product;

-- 去重复列，返回的是对应的列
SELECT DISTINCT price FROM product;

-- 对查询列进行运算
SELECT price+50 from product;

```


## 条件查询
```sql
-- 查询价格大于等于1000的商品
select *from product where price>=1000;

-- 查询价格在100-1500之间的商品
select *from product where price BETWEEN 100 and 1500;

-- 查询价格不在100-1500之间的商品
select *from product where price NOT BETWEEN 100 and 1500;

-- 查询价格为3000或5000的商品
select *from product where price IN(3000,5000);
select *from product where price=3000 OR price=5000;
select *from product where price=3000 || price=5000;

-- 查询价格不是3000且不是5000的商品
select *FROM product where price NOT IN(3000,5000);

-- 查询商品名称带有'洗衣机'的商品
select *FROM product where pname LIKE '%洗衣机%';

-- 查询商品名第二个字为'力'的商品
select * FROM product where pname LIKE '_力%';

-- 查询商品目录id为Null的商品
SELECT *FROM product where category_id IS NULL;

-- 查询价格在1000-5000之间的洗衣机
select * FROM product where (pname LIKE '%洗衣机%') AND (price BETWEEN 1000 AND 5000);
```

## 排序查询
+ `ORDER BY 字段列表或表达式`
+ `asc`：ascend，升序
+ `desc`：descend，降序


```sql
-- 按照价格降序排列
SELECT * FROM product ORDER BY price desc;

-- 按照分类id升序，价格降序
SELECT *FROM product order by category_id asc,price desc; 
```

## 聚合函数

| 函数                              | 描述                                          | 备注       |
| --------------------------------- | --------------------------------------------- | ---------- |
| COUNT([DISTINCT] expr1,expr2,...) | 统计参数不为Null的个数，当参数为*，统计所有行 |            |
| SUM([DISTINCT] expr)              | 对参数求和                                    | 忽略NULL值 |
| MIN([DISTINCT] expr)              | 求参数的最小值                                | 忽略NULL值 |
| MAX([DISTINCT] expr)              | 求参数最大值                                  | 忽略NULL值 |
| AVG([DISTINCT] expr)              | 求参数平均值                                  | 忽略NULL值 |

### Example

```sql
-- 统计商品条目
select count(*) FROM product;

-- 统计商品分类的数量
select COUNT(DISTINCT category_id) FROM product; 

-- 查询所有商品总价
select SUM(price) from product;

-- 查询最低价格，最高价格
select MIN(price),MAX(price) from product; 

-- 查询所有商品均价
SELECT AVG(price) from product;
```

## 分组查询
关键字：`GROUP BY`、`HAVING`
+ GROUP BY：将所有的行根据指定的字段的值分组，相同为一组。后面写分组字段列表，以","分隔  
  如：`GROUP BY category_id`
+ HAVING：对分组后的结果进行筛选，后面跟的是条件表达式  
  如：`HAVING COUNT(*)>=10`

### Example
```sql
-- 查询每个商品分类的商品总量
SELECT category_id,COUNT(*) from product GROUP BY category_id;

-- 相同分类、相同价格为一组，求这样的分组的每个组的商品数量
SELECT category_id,price FROM product GROUP BY category_id,price;

-- 相同分类、相同价格为一组，求这样的分组的每个组的商品数量且筛选出平均价格在1000以下的分组
SELECT category_id,price,count(*) FROM product GROUP BY category_id,price HAVING AVG(price)<=1000;
```
**注意**
+ GROUP BY后面可以有多个分组字段
+ 使用了分组关键词后，SELECT后面只能跟**分组字段**或者**聚合函数**。
+ GROUP BY一般配合聚合函数使用才有意义。
+ HAVING后面跟表达式，表达式的操作数可以是**分组字段**或**聚合函数**。

## LIMIT查询
用法：`LMIMIT [offset,]rows`，表示从第offset条记录开始，往后取ROWS条记录并返回，offset不写则默认为0。
### Example

```sql
-- 查询前10个商品
SELECT * FROM product LIMIT 10;

-- 查询第10-20个商品
SELECT * FROM product LIMIT 10,20;
```

# 单表查询-练习
