---
layout: post
date: 2022-02-03 17:55:24 +0800
author: solitaryclown
title: Redis操作
categories: database
tags: Redis
# permalink: /:categories/:title.html
excerpt: "Redis操作"
---
* content
{:toc}

# 1. Redis操作
## 1.1. help
`help`命令可以查询redis中所有命令的用法

## 1.2. value类型
### 1.2.1. string 
`help @string`可以查看string类型的所有操作命令。

常用操作：  

| 命令格式                        | 描述                           |
| :------------------------------ | :----------------------------- |
| `SET key value`                 | 添加一个string类型键值对       |
| `MSET key value [key value...]` | 批量添加多个string类型键值对   |
| `GET key`                       | 获取一个string类型的值         |
| `MGET key`                      | 获取多个string类型的值         |
| `APPEND key value`              | 对一个string键值对进行内容追加 |
| `SETEX key seconds value`       | 设置一个string键值对的时效性   |
| ...                             | ...                            |

#### 1.2.1.1. 整数运算
string类型存储单个字符串，如果value为一个整数形式，则可以对其进行整数相关操作，如redis提供了`incr`、`incrby`、`decr`等对整数形式的value进行运算，在运算时会将value转为数值类型进行运算，但底层的数据依然是以字符串的形式存储（redis是用C语言开发的，因此底层存储string用的是char[]）

string类型整数形式支持的最大值是9223372036854775807（在Java中为Long.MAX_VALUE）

#### 1.2.1.2. 时效性
redis提供对键值对存储时间的限制，过期自动删除。
- `SETEX key seconds value`：设置string键值对过期时间，以秒为单位
- `PSETEX key milliseconds value`：功能同上，以毫秒为单位



### 1.2.2. hash
在redis中，hash是多个string类型的field和value的映射表，是表示Objects的最合适的数据结构。
一个key对应一个hash结构，里面包括多个字段和对应的值。
例如，一个学生对象，包括学号、姓名、年龄等等。

```shell
127.0.0.1:6379> hmset user:20210001 name Tom age 22
OK
127.0.0.1:6379> hgetall user:20210001
1) "name"
2) "Tom"
3) "age"
4) "22"
127.0.0.1:6379> hmget user:20210001 name age
1) "Tom"
2) "22"
127.0.0.1:6379>
```

**`help @hash`**：查看hash数据结构的所有相关命令。

### 1.2.3. list
在redis中，list用来存储列表数据，底层数据结构为**双向链表**。

`help @list`：查看list相关的操作。

常用操作：  

| 命令                           | 描述                                    | 备注                                    |
| :----------------------------- | :-------------------------------------- | :-------------------------------------- |
| `lpush key value [value ...] ` | 从左边插入value到键为key的list中        |                                         |
| `rpush key value [value ...] ` | 从右边插入value到键为key的list中        |                                         |
| `lpop key`                     | 删除最左边的元素并返回                  |                                         |
| `rpop key`                     | 删除最右边的元素并返回                  |                                         |
| `lrange key start stop`        | 获取list中索引从start到stop的values     | 索引可以为负数，-n代表从右到左第n个元素 |
| `lindex key index`             | 获取list中索引为index的元素             | 同上                                    |
| `BLPOP key [key ...] timeout`  | 在timeout时间内阻塞获取list第一个元素   | 如果timeout内获得则停止等待立即返回     |
| `BRPOP key [key ...] timeout`  | 在timeout时间内阻塞获取list最后一个元素 | 同上                                    |
| `LREM key count value`         | 从list中移除一个value                   |                                         |


### 1.2.4. Set
Set用来存储集合数据，集合中不能有重复的value。Set底层数据结构和hash一样是哈希表。

`help @set`：查看Set相关的操作。

常用操作：  

| 命令                           | 描述                                | 备注 |
| :----------------------------- | :---------------------------------- | :--- |
| `SADD key member [member ...]` | 往set中添加元素                     |      |
| `SCARD key`                    | 获取set中的元素数量                 |      |
| `SISMEMBER key member`         | 获取set中的所有元素                 |      |
| `SREM key member [member ...]` | 移除set中的一个或多个元素           |      |
| `SREM key member [member ...]` | 移除set中的一个或多个元素           |      |
| `SRANDMEMBER key [count]`      | 从set中随机返回一个或多个元素       |      |
| `SPOP key [count]`             | 从set中随机删除并返回一个或多个元素 |      |

#### 1.2.4.1. 集合运算
集合有3种运算：交、并、差（补）
redis对Set实现了这3种运算：  
+ `SINTER key [key ...]`：返回多个集合的交集
+ `SUNION key [key ...]`：返回多个集合的并集
+ `SDIFF key [key ...]`：返回多个集合的差集

此外，redis对集合运算的结果也提供操作，比如`SINTERSTORE`、`SUNIONSTORE`、`SDIFFSTORE`等。

示例：  
```shell
127.0.0.1:6379> sadd set1 a b c d e
(integer) 5
127.0.0.1:6379> sadd set2 c d e f g
(integer) 5
127.0.0.1:6379> sinter set1 set2
1) "d"
2) "e"
3) "c"
127.0.0.1:6379> sunion set1 set2
1) "d"
2) "b"
3) "f"
4) "g"
5) "a"
6) "c"
7) "e"
127.0.0.1:6379> sdiff set1 set2
1) "a"
2) "b"
127.0.0.1:6379>
```

### 1.2.5. sorted_set
redis中sorted_set支持对集合元素排序，每个value对应一个数值类型的score，在添加时设置score的值，依据score排序。

`help @sorted_set`：查看所有sorted_set相关命令。

常用操作：
+ `ZADD key [NX|XX] [CH] [INCR] score member [score member ...]`：向sorted_set添加一个或多个元素，如果元素存在则更新其score
+ `ZCARD key`：返回sorted_set中元素的数量
+ `ZRANGE key start stop [WITHSCORES]`：按照索引返回sorted_set中一定范围的元素（score从低到高）
+ `ZREVRANGE key start stop [WITHSCORES]`：按照索引返回sorted_set中一定范围的元素，并按score从高到低的顺序，和ZRANGE顺序相反。
+ ...

## 通用命令
`help @generic`：查看5种类型的key都支持的操作

常用：  
- `DEL key [key ...]`：删除一个或多个key
- `EXISTS key [key ...]`：判断key在数据库中是否存在，返回存在的key的个数
- `EXPIRE key seconds`：设置key的存活时间
- `PERSIST key`：取消key的有限存活时间
- `TTL key`：返回key剩下的存活时间，单位为seconds
- ` PTTL key`：返回key剩下的存活时间，单位为milliseconds
- `RENAME key`：重命名key
- `Keys pattern`：查询符合指定规则的key